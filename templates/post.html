{% extends "layouts/index.html" %}
{% block title %}{% if post.title %}{{ post.title }}{% else %}Thread #{{ post.id }}{% endif %} - /{{ post.board.name }}/: {{ post.board.title }}{% endblock %}
{% block body %}
<h1 class="text-center font-bold text-3xl pt-4">/{{ post.board.name }}/ - {{ post.board.title }} <i id="toggle-fav" class="fas fa-star fa-fw cursor-pointer {% if post.board._favorite %}text-yellow-500{% else %}text-muted{% endif %}" onclick="toggleFavorite('{{ post.board.name }}')"></i></h1>
<p class="text-center text-muted text-lg pb-4">{{ post.board.description }}</p>
<p class="text-center"><a href="#">Mod log</a> Â· <a href="#">Mods</a></p>
<div class="my-2">
    <div class="p-2 flex justify-center">
        <div>
            <p id="post-toggle-parent" class="text-center text-xl">[<a id="post-toggle" href="javascript:togglePostForm()">Post a reply</a>]</p>
            <form id="submit-post-form" class="p-2 hidden" action="/{{ post.board.name }}/{{ post.id }}" method="post">
                <table>
                    <tbody>
                        <tr>
                            <td>Options</td>
                            <td>
                                <input type="text" name="options" />
                                <input type="submit" value="Post">
                            </td>
                        </tr>
                        <tr>
                            <td>Comment</td>
                            <td>
                                <textarea id="re-body" required="" name="body"></textarea>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </form>
        </div>
    </div>
    <hr />
    <p class="p-2">
        [<a href="{{ post.board.url }}">Return</a>]
    </p>
    <hr />
</div>
<div class="flex flex-row justify-between">
    <div class="flex-grow p-3">
        {% if u and u.is_admin %}
        <div class="w-full block bg-color-secondary md:hidden p-2 border border-gray-400">
            <p class="text-center font-bold text-muted">Admin panel</p>
            {% if post.board.is_banned %}<p class="text-red-600">Parent board is banned{% if post.board.ban_reason %} <i>({{ post.board.ban_reason }}){% endif %}</i></p>{% endif %}
            <p><strong>Creation IP: </strong>{{ post.creation_ip }}</p>
            <p><strong>Last bumped: </strong>{{ post.last_bumped_date }}</p>
            <div class="flex justify-around text-lg mt-1">
                <div id="mobile-admin-delete-btn" class="text-red-500 font-semibold cursor-pointer" onclick="toggleDeleteForm()">
                    <i class="fa fa-trash"></i> Delete
                </div>
                <div id="mobile-admin-move-btn" class="text-yellow-500 font-semibold cursor-pointer" onclick="toggleMoveForm()">
                    <i class="fa fa-arrow-right"></i> Move
                </div>
            </div>
            <form id="mobile-admin-move" action="/*/admin/move" method="post" class="hidden space-y-2">
                <input type="hidden" name="formkey" value="{{ u.formkey }}" />
                <input type="hidden" name="post" value="{{ post.id }}" />
                <input type="text" name="dest" required="" placeholder="destination board" class="w-full p-2 rounded transition duration-100 border-2 border-gray-300 focus:border-yellow-400" />
                <input type="submit" class="w-full text-white rounded font-semibold p-2 cursor-pointer transition duration-100 bg-yellow-400 hover:bg-yellow-500" value="Move" />
            </form>
            <form id="mobile-admin-delete" action="/*/admin/remove/{{ post.id }}" method="post" class="hidden space-y-2">
                <input type="hidden" name="formkey" value="{{ u.formkey }}" />
                <input type="text" class="w-full rounded p-2 transition duration-100 border-2 border-gray-300 focus:border-red-400" placeholder="reason" name="reason" />
                <input type="submit" class="w-full text-white rounded font-semibold p-2 cursor-pointer transition duration-100 bg-red-500 hover:bg-red-600" value="Delete" />
            </form>
        </div>
        {% endif %}
        <div id="p{{ post.id }}" class="post p-4 w-full">
            <p class="text-muted text-sm"><strong>{% if post.title %}{{ post.title }}{% endif %} {% if post.author %}<span class="text-green-600">{{ post.author.username }}</span>{% else %}<span class="text-blue-500">Anonymous</span>{% endif %}</strong> <span title="{{ post.age }}">{{ post.created_date }}</span> <a href="#p{{ post.id }}" title="Link to this post">No.</a><a href="javascript:quote('{{ post.id }}')" title="Reply">{{ post.id }}</a> <span class="text-xs">{% for re in post.mentions %} <a href="#p{{ re }}">>>{{ re }}</a>{% endfor %}</span></p>
            <div class="usercontent p-3">{{ post.body_html|markdown }}</div>
        </div>
        {% set comments = post.comment_list() %}
        {% include "comment_listing.html" %}
        <hr />
    </div>
    {% if u and u.is_admin %}
    <div class="flex-shrink-0 w-72 hidden md:block text-sm m-5">
        <div class="border border-gray-400 rounded bg-color-secondary">
            <div class="p-3 border-b border-gray-400 font-semibold text-muted">
                Admin panel
            </div>
            <div class="p-3">
                <div class="py-2">
                    {% if post.board.is_banned %}<p class="text-red-600">Parent board is banned{% if post.board.ban_reason %} <i>({{ post.board.ban_reason }}){% endif %}</i></p>{% endif %}
                    <p><strong>Creation IP: </strong>{{ post.creation_ip }}</p>
                    <p><strong>Last bumped: </strong>{{ post.last_bumped_date }}</p>
                    <p>
                        <a href="{{ post.permalink }}.source">View source</a>
                    </p>
                </div>
                <div class="p-2">
                    <form action="/*/admin/purge_comments_cache/{{ post.id }}" method="post">
                        <input type="hidden" name="formkey" value="{{ u.formkey }}" />
                        <input type="submit" class="w-full text-white rounded font-semibold p-2 cursor-pointer transition duration-100 bg-yellow-400 hover:bg-yellow-500" value="Purge Cached Replies" />
                    </form>
                </div>
                <div class="p-2">
                    <p class="text-muted text-sm font-bold my-1">Move thread</p>
                    <form action="/*/admin/move" method="post">
                        <input type="hidden" name="formkey" value="{{ u.formkey }}" />
                        <input type="hidden" name="post" value="{{ post.id }}" />
                        <input type="text" name="dest" required="" placeholder="destination board" class="w-full p-2 rounded transition duration-100 border-2 border-gray-300 focus:border-yellow-400" />
                        <input type="submit" class="w-full text-white rounded font-semibold mt-3 p-2 cursor-pointer transition duration-100 bg-yellow-400 hover:bg-yellow-500" value="Move" />
                    </form>
                </div>
                <div class="p-2">
                    <p class="text-muted text-sm font-bold my-1">Delete thread</p>
                    <form action="/*/admin/remove/{{ post.id }}" method="post">
                        <input type="hidden" name="formkey" value="{{ u.formkey }}" />
                        <input type="text" class="w-full rounded p-2 transition duration-100 border-2 border-gray-300 focus:border-red-400" placeholder="reason" name="reason" />
                        <input type="submit" class="w-full text-white rounded font-semibold mt-3 p-2 cursor-pointer transition duration-100 bg-red-500 hover:bg-red-600" value="Delete" />
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
{% block script %}
<script>
    const toggleDeleteForm = () => {
        const b = document.getElementById("mobile-admin-delete-btn");
        const f = document.getElementById("mobile-admin-delete");
        const b2 = document.getElementById("mobile-admin-move-btn");
        const f2 = document.getElementById("mobile-admin-move");

        if (b2.classList.contains("text-gray-500")) {
            b2.classList.add("text-yellow-500");
            b2.classList.remove("text-gray-500");

            f2.classList.add("hidden");
            f2.classList.remove("block");
        }

        b.classList.toggle("text-gray-500");
        b.classList.toggle("text-red-500");

        f.classList.toggle("hidden");
        f.classList.toggle("block");
    };

    const toggleMoveForm = () => {
        const b = document.getElementById("mobile-admin-delete-btn");
        const f = document.getElementById("mobile-admin-delete");
        const b2 = document.getElementById("mobile-admin-move-btn");
        const f2 = document.getElementById("mobile-admin-move");

        if (b.classList.contains("text-gray-500")) {
            b.classList.add("text-red-500");
            b.classList.remove("text-gray-500");

            f.classList.add("hidden");
            f.classList.remove("block");
        }

        b2.classList.toggle("text-gray-500");
        b2.classList.toggle("text-yellow-500");

        f2.classList.toggle("hidden");
        f2.classList.toggle("block");
    };
</script>
{% endblock %}
